## 課題1

### mail_addressに対するCHECK制約
- 使うべきではない。
  - 対象ドメインの追加や変更はそれなりに発生するのではと感じるが、CHECK制約を用いた場合は都度DB定義の修正が都度発生することになる。
    - DB定義を変更した場合、テーブル全体に影響が及んでしまう。
      - 例えば、以前のドメインのメールアドレスは変更したくない、でも新規で追加するデータのドメインは新ドメインのみにしたいとなったら、定義と実際のレコードに差異が発生してしまう。
      - 定義やレコードから仕様が読み取りにくくなってしまい、バグの原因となる。
    - 正規表現等でも制約をかけられるようだが、可読性が悪そう（ぱっと見で何をやっているのかが分かりにくそう）

### ユーザー退会時のTRIGGER
- 使うべきではない。
  - 理由として、シンプルにデメリットが大きいこと、同一トランザクション内での処理にすれば、容易に実行できる処理なので、DB制約にロジックを隠蔽する必要はないと考える。
    - DB側の制約でDELETE及びINSERTが実行されるため、アプリケーション開発者から見ると処理がブラックボックス化されてしまう。アプリ内のコードを見ても分からない仕様が生まれるため、意図しない処理・バグの原因になる可能性がある。
    - 「ユーザーが退会する」というユースケースの中では、テーブル移動以外の処理も必要だと思われる。アプリケーション側のコードをイメージすると、ユーザーテーブルに関する処理のみがDB制約によって実現されることが不自然であり、他の開発者に伝わりづらい実装になってしまう。
  - メリットはあまり思い浮かばなかった。。

### 　genderに対するENUM
- 使うべきではない。
    - 前提として、genderで定義される値が追加される可能性がありそうと感じたのと、追加された場合はマスターテーブルにレコード追加する形の方が運用工数がかからないのではと感じた。
      - ENUMで定義した場合は既存の値を更新をする際、①ENUMに追加②既存のレコードの値を修正③ENUMから変更元のデータを削除するという手順を踏む必要がある
      - 比較して、マスターテーブルを用いた場合は、①UPDATE文を一回実行するのみである
    - ENUMでとりうる値を見る際は、定義を参照しなければいけない
    - こちらもTRIGGER同様にメリットが思い浮かばなかった。。
- 参考：https://shiro-secret-base.com/?p=928#ENUMDB

### 　post_codeに対するDOMAIN
- 使うべきではない。
  - 上で書いた通り、ロジックがDB側に書かれることは、開発者の混乱を招きバグの原因になると感じた。

### どのようなときにDB側で制約すべき/アプリ側で制約すべきか
- データ型や正規化の範囲で、入ってはいけないデータを最低限入れさせないことを担保するためにDB側で制約をかける。
- 複雑なロジックが絡む場合は、アプリ側で制約を設けるべき。
  - DB側にロジックを持たせる場合、以下のデメリットがある。
    - 拡張性が乏しいこと
    - 参照する際に定義をみる必要があること
    - 既存のレコードに影響を及ぼす必要があること

## 課題2
- 仮入会ユーザーの申し込みが完了したら、ユーザーテーブルにINSERTする処理をTRIGGER機能を用いて実装している